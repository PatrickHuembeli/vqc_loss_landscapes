---

title: Title

keywords: fastai
sidebar: home_sidebar



---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: Ex2_Train_pennylane_Hessian.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">pennylane</span> <span class="k">as</span> <span class="nn">qml</span>

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="kn">import</span> <span class="nn">os</span>

<span class="kn">import</span> <span class="nn">pennylane</span> <span class="k">as</span> <span class="nn">qml</span>
<span class="kn">from</span> <span class="nn">pennylane</span> <span class="kn">import</span> <span class="n">expval</span><span class="p">,</span> <span class="n">var</span>

<span class="kn">from</span> <span class="nn">vqc_loss_landscapes.pennylanecirq</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">vqc_loss_landscapes.data_helper</span> <span class="kn">import</span> <span class="o">*</span>

<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>


<span class="kn">from</span> <span class="nn">pennylane</span> <span class="kn">import</span> <span class="n">numpy</span> <span class="k">as</span> <span class="n">np</span>
<span class="kn">from</span> <span class="nn">pennylane.utils</span> <span class="kn">import</span> <span class="n">_flatten</span><span class="p">,</span> <span class="n">unflatten</span>
<span class="kn">from</span> <span class="nn">pennylane.optimize</span> <span class="kn">import</span> <span class="n">AdamOptimizer</span><span class="p">,</span> <span class="n">GradientDescentOptimizer</span>

<span class="kn">from</span> <span class="nn">tqdm</span> <span class="kn">import</span> <span class="n">tqdm_notebook</span> <span class="k">as</span> <span class="n">tqdm</span>

<span class="o">%</span><span class="k">load_ext</span> autoreload
<span class="o">%</span><span class="k">autoreload</span> 2
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Quick test run of the circuit</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">width</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">device</span> <span class="o">=</span> <span class="s2">&quot;qiskit.aer&quot;</span>
<span class="n">num_layers</span> <span class="o">=</span> <span class="mi">2</span>

<span class="n">model</span> <span class="o">=</span> <span class="n">Reuploading_model</span><span class="p">(</span><span class="n">device</span> <span class="o">=</span> <span class="n">device</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="n">width</span><span class="p">,</span> <span class="n">layers</span><span class="o">=</span><span class="n">num_layers</span><span class="p">)</span>
<span class="n">dev</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">dev</span>
<span class="n">params</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">init_params</span>
<span class="n">model</span><span class="o">.</span><span class="n">qcircuit</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>0.5439453125</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Train Circuit and calculate Hessian during training</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">num_test</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">Xtest</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">generate_circle_data</span><span class="p">(</span><span class="n">num_test</span><span class="p">)</span>
<span class="n">X_test</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">Xtest</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">Xtest</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">))))</span> <span class="c1"># Make input data 3D for Rot()</span>

<span class="n">zz</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">qcircuit</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">X_test</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">y_test</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">y_test</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">zz</span><span class="p">)</span>




<span class="n">directory</span> <span class="o">=</span> <span class="s2">&quot;reupload_simple_circle&quot;</span>
<span class="c1">#model.save_epoch(1, 0.1, [1,2,3], directory, params, H_train= [1,2], Hev_train=[1,2], H_test=[1,2,3], Hev_test=[1,2])</span>

<span class="c1"># Generate training and test data</span>
<span class="n">num_training</span> <span class="o">=</span> <span class="mi">200</span>
<span class="n">num_test</span> <span class="o">=</span> <span class="mi">1000</span>

<span class="n">epsilon</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1">#In re-uploading paper they take 2D input and convert it to 3D, but the last entry is simply 0.</span>
                <span class="c1"># This is because the Rot() gate takes 3 parameters. But pennylane devides the gradient by this</span>
                <span class="c1"># Value and therefore we get an error, when we do that. So we can either add some small value</span>
                <span class="c1"># epsilon. Or we change the qnode class in pennylane. For instruction, see below.</span>

<span class="n">Xdata</span><span class="p">,</span> <span class="n">y_train</span> <span class="o">=</span> <span class="n">generate_circle_data</span><span class="p">(</span><span class="n">num_training</span><span class="p">)</span>
<span class="n">X_train</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">Xdata</span><span class="p">,</span> <span class="n">epsilon</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">Xdata</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">))))</span>

<span class="n">Xtest</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">generate_circle_data</span><span class="p">(</span><span class="n">num_test</span><span class="p">)</span>
<span class="n">X_test</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">Xtest</span><span class="p">,</span> <span class="n">epsilon</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">Xtest</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">))))</span>



<span class="n">epochs</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">batch_size</span> <span class="o">=</span> <span class="mi">32</span>

<span class="k">def</span> <span class="nf">training_run</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">num_layers</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="c1">#device = &#39;default.qubit&#39;</span>
    <span class="n">device</span> <span class="o">=</span> <span class="s1">&#39;forest.numpy_wavefunction&#39;</span>

    <span class="c1">#model = Reuploading_model(device = device, width=width, layers=num_layers)</span>
    <span class="n">qcirc</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">qcircuit</span>

    <span class="n">lr</span> <span class="o">=</span> <span class="mf">0.5</span>


    <span class="n">params</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">init_params</span>

    <span class="n">loss_list</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">it</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">epochs</span><span class="p">)):</span>
        <span class="n">H_train</span> <span class="o">=</span> <span class="n">Hessian</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">X</span><span class="o">=</span><span class="n">X_train</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">10</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">y_train</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">10</span><span class="p">])</span>
        <span class="n">Hev_train</span><span class="p">,</span> <span class="n">Hv_train</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">eigh</span><span class="p">(</span><span class="n">H_train</span><span class="p">)</span>
        <span class="n">opt</span> <span class="o">=</span> <span class="n">qml</span><span class="o">.</span><span class="n">GradientDescentOptimizer</span><span class="p">(</span><span class="n">lr</span><span class="p">)</span>

        <span class="n">predicted_train</span><span class="p">,</span> <span class="n">states_train</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">test</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
        <span class="n">accuracy_train</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">accuracy_score</span><span class="p">(</span><span class="n">y_train</span><span class="p">,</span> <span class="n">predicted_train</span><span class="p">)</span>
        <span class="n">loss</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">cost</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
        <span class="n">loss_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">loss</span><span class="p">)</span>

        <span class="n">predicted_test</span><span class="p">,</span> <span class="n">states_test</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">test</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)</span>
        <span class="n">accuracy_test</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">accuracy_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">predicted_test</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">Xbatch</span><span class="p">,</span> <span class="n">ybatch</span> <span class="ow">in</span> <span class="n">iterate_minibatches</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="n">batch_size</span><span class="p">):</span>
            <span class="n">params</span> <span class="o">=</span> <span class="n">opt</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="k">lambda</span> <span class="n">v</span><span class="p">:</span> <span class="n">model</span><span class="o">.</span><span class="n">cost</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">Xbatch</span><span class="p">,</span> <span class="n">ybatch</span><span class="p">),</span> <span class="n">params</span><span class="p">)</span>

        <span class="n">res</span> <span class="o">=</span> <span class="p">[</span><span class="n">it</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">loss</span><span class="p">,</span> <span class="n">accuracy_train</span><span class="p">,</span> <span class="n">accuracy_test</span><span class="p">]</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Epoch: </span><span class="si">{:2d}</span><span class="s2"> | Loss: </span><span class="si">{:3f}</span><span class="s2"> | Train accuracy: </span><span class="si">{:3f}</span><span class="s2"> | Test accuracy: </span><span class="si">{:3f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">res</span><span class="p">))</span>


<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;start_training&quot;</span><span class="p">)</span>
<span class="n">training_run</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">num_layers</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>1 0.3447265625
start_training
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>/Users/patrickhuembeli/anaconda3/envs/QC/lib/python3.7/site-packages/ipykernel_launcher.py:53: TqdmDeprecationWarning: This function will be removed in tqdm==5.0.0
Please use `tqdm.notebook.tqdm` instead of `tqdm.tqdm_notebook`
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Hessian Dimension: 24, 24

Epoch:  1 | Loss: 0.002275 | Train accuracy: 0.450000 | Test accuracy: 0.487000
Hessian Dimension: 24, 24
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_text output_error">
<pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">KeyboardInterrupt</span>                         Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-23-0b17cad33bae&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-intense-fg ansi-bold">     80</span> 
<span class="ansi-green-intense-fg ansi-bold">     81</span> print<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">&#34;start_training&#34;</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg">---&gt; 82</span><span class="ansi-red-fg"> </span>training_run<span class="ansi-blue-fg">(</span>width<span class="ansi-blue-fg">=</span><span class="ansi-cyan-fg">2</span><span class="ansi-blue-fg">,</span> num_layers<span class="ansi-blue-fg">=</span><span class="ansi-cyan-fg">2</span><span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">&lt;ipython-input-23-0b17cad33bae&gt;</span> in <span class="ansi-cyan-fg">training_run</span><span class="ansi-blue-fg">(width, num_layers)</span>
<span class="ansi-green-intense-fg ansi-bold">     52</span> 
<span class="ansi-green-intense-fg ansi-bold">     53</span>     <span class="ansi-green-fg">for</span> it <span class="ansi-green-fg">in</span> tqdm<span class="ansi-blue-fg">(</span>range<span class="ansi-blue-fg">(</span>epochs<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">---&gt; 54</span><span class="ansi-red-fg">         </span>H_train <span class="ansi-blue-fg">=</span> Hessian<span class="ansi-blue-fg">(</span>params<span class="ansi-blue-fg">,</span> model<span class="ansi-blue-fg">,</span> X<span class="ansi-blue-fg">=</span>X_train<span class="ansi-blue-fg">[</span><span class="ansi-cyan-fg">0</span><span class="ansi-blue-fg">:</span><span class="ansi-cyan-fg">10</span><span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">,</span> y<span class="ansi-blue-fg">=</span>y_train<span class="ansi-blue-fg">[</span><span class="ansi-cyan-fg">0</span><span class="ansi-blue-fg">:</span><span class="ansi-cyan-fg">10</span><span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     55</span>         Hev_train<span class="ansi-blue-fg">,</span> Hv_train <span class="ansi-blue-fg">=</span> np<span class="ansi-blue-fg">.</span>linalg<span class="ansi-blue-fg">.</span>eigh<span class="ansi-blue-fg">(</span>H_train<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     56</span> <span class="ansi-red-fg">#         lr = 1/Hev_train.max()</span>

<span class="ansi-green-fg">~/Dropbox/vqc_loss_landscapes/vqc_loss_landscapes/pennylanecirq.py</span> in <span class="ansi-cyan-fg">Hessian</span><span class="ansi-blue-fg">(params, model, X, y, Z_measure)</span>
<span class="ansi-green-intense-fg ansi-bold">    168</span>                     eps_mm<span class="ansi-blue-fg">[</span>l<span class="ansi-blue-fg">]</span> <span class="ansi-blue-fg">-=</span> eps
<span class="ansi-green-intense-fg ansi-bold">    169</span> 
<span class="ansi-green-fg">--&gt; 170</span><span class="ansi-red-fg">                     </span>measure_pp <span class="ansi-blue-fg">=</span> model<span class="ansi-blue-fg">.</span>cost<span class="ansi-blue-fg">(</span>eps_pp<span class="ansi-blue-fg">.</span>reshape<span class="ansi-blue-fg">(</span>shape<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">,</span> Xbatch<span class="ansi-blue-fg">,</span> ybatch<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    171</span>                     measure_pm <span class="ansi-blue-fg">=</span> model<span class="ansi-blue-fg">.</span>cost<span class="ansi-blue-fg">(</span>eps_pm<span class="ansi-blue-fg">.</span>reshape<span class="ansi-blue-fg">(</span>shape<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">,</span> Xbatch<span class="ansi-blue-fg">,</span> ybatch<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    172</span>                     measure_mp <span class="ansi-blue-fg">=</span> model<span class="ansi-blue-fg">.</span>cost<span class="ansi-blue-fg">(</span>eps_mp<span class="ansi-blue-fg">.</span>reshape<span class="ansi-blue-fg">(</span>shape<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">,</span> Xbatch<span class="ansi-blue-fg">,</span> ybatch<span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">~/Dropbox/vqc_loss_landscapes/vqc_loss_landscapes/pennylanecirq.py</span> in <span class="ansi-cyan-fg">cost</span><span class="ansi-blue-fg">(self, params, x, y, Z_measure)</span>
<span class="ansi-green-intense-fg ansi-bold">     78</span>         loss <span class="ansi-blue-fg">=</span> <span class="ansi-cyan-fg">0.0</span>
<span class="ansi-green-intense-fg ansi-bold">     79</span>         <span class="ansi-green-fg">for</span> i <span class="ansi-green-fg">in</span> range<span class="ansi-blue-fg">(</span>len<span class="ansi-blue-fg">(</span>x<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">---&gt; 80</span><span class="ansi-red-fg">             </span>fidelity <span class="ansi-blue-fg">=</span> self<span class="ansi-blue-fg">.</span>qcircuit<span class="ansi-blue-fg">(</span>params<span class="ansi-blue-fg">,</span> x<span class="ansi-blue-fg">=</span>x<span class="ansi-blue-fg">[</span>i<span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">,</span> y<span class="ansi-blue-fg">=</span>y<span class="ansi-blue-fg">[</span>i<span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">,</span> Z_measure<span class="ansi-blue-fg">=</span>Z_measure<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     81</span>             loss <span class="ansi-blue-fg">+=</span> <span class="ansi-blue-fg">(</span><span class="ansi-cyan-fg">1</span> <span class="ansi-blue-fg">-</span> fidelity<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     82</span>         <span class="ansi-green-fg">return</span> loss<span class="ansi-blue-fg">/</span>len<span class="ansi-blue-fg">(</span>x<span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">~/anaconda3/envs/QC/lib/python3.7/site-packages/pennylane/interfaces/autograd.py</span> in <span class="ansi-cyan-fg">__call__</span><span class="ansi-blue-fg">(self, *args, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">     45</span>             <span class="ansi-red-fg"># prevents autograd boxed arguments from going through to evaluate</span>
<span class="ansi-green-intense-fg ansi-bold">     46</span>             args <span class="ansi-blue-fg">=</span> autograd<span class="ansi-blue-fg">.</span>builtins<span class="ansi-blue-fg">.</span>tuple<span class="ansi-blue-fg">(</span>args<span class="ansi-blue-fg">)</span>  <span class="ansi-red-fg"># pylint: disable=no-member</span>
<span class="ansi-green-fg">---&gt; 47</span><span class="ansi-red-fg">             </span><span class="ansi-green-fg">return</span> self<span class="ansi-blue-fg">.</span>evaluate<span class="ansi-blue-fg">(</span>args<span class="ansi-blue-fg">,</span> kwargs<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     48</span> 
<span class="ansi-green-intense-fg ansi-bold">     49</span>         <span class="ansi-blue-fg">@</span>staticmethod

<span class="ansi-green-fg">~/anaconda3/envs/QC/lib/python3.7/site-packages/autograd/tracer.py</span> in <span class="ansi-cyan-fg">f_wrapped</span><span class="ansi-blue-fg">(*args, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">     46</span>             <span class="ansi-green-fg">return</span> new_box<span class="ansi-blue-fg">(</span>ans<span class="ansi-blue-fg">,</span> trace<span class="ansi-blue-fg">,</span> node<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     47</span>         <span class="ansi-green-fg">else</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">---&gt; 48</span><span class="ansi-red-fg">             </span><span class="ansi-green-fg">return</span> f_raw<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">*</span>args<span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">**</span>kwargs<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     49</span>     f_wrapped<span class="ansi-blue-fg">.</span>fun <span class="ansi-blue-fg">=</span> f_raw
<span class="ansi-green-intense-fg ansi-bold">     50</span>     f_wrapped<span class="ansi-blue-fg">.</span>_is_autograd_primitive <span class="ansi-blue-fg">=</span> <span class="ansi-green-fg">True</span>

<span class="ansi-green-fg">~/anaconda3/envs/QC/lib/python3.7/site-packages/pennylane/qnodes/base.py</span> in <span class="ansi-cyan-fg">evaluate</span><span class="ansi-blue-fg">(self, args, kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">    777</span>                 self<span class="ansi-blue-fg">.</span>circuit<span class="ansi-blue-fg">.</span>observables<span class="ansi-blue-fg">,</span>
<span class="ansi-green-intense-fg ansi-bold">    778</span>                 self<span class="ansi-blue-fg">.</span>variable_deps<span class="ansi-blue-fg">,</span>
<span class="ansi-green-fg">--&gt; 779</span><span class="ansi-red-fg">                 </span>return_native_type<span class="ansi-blue-fg">=</span>temp<span class="ansi-blue-fg">,</span>
<span class="ansi-green-intense-fg ansi-bold">    780</span>             )
<span class="ansi-green-intense-fg ansi-bold">    781</span>         <span class="ansi-green-fg">return</span> self<span class="ansi-blue-fg">.</span>output_conversion<span class="ansi-blue-fg">(</span>ret<span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">~/anaconda3/envs/QC/lib/python3.7/site-packages/pennylane/_device.py</span> in <span class="ansi-cyan-fg">execute</span><span class="ansi-blue-fg">(self, queue, observables, parameters, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">    192</span>             <span class="ansi-green-fg">for</span> obs <span class="ansi-green-fg">in</span> observables<span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    193</span>                 <span class="ansi-green-fg">if</span> obs<span class="ansi-blue-fg">.</span>return_type <span class="ansi-green-fg">is</span> Expectation<span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">--&gt; 194</span><span class="ansi-red-fg">                     </span>results<span class="ansi-blue-fg">.</span>append<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">.</span>expval<span class="ansi-blue-fg">(</span>obs<span class="ansi-blue-fg">.</span>name<span class="ansi-blue-fg">,</span> obs<span class="ansi-blue-fg">.</span>wires<span class="ansi-blue-fg">,</span> obs<span class="ansi-blue-fg">.</span>parameters<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    195</span> 
<span class="ansi-green-intense-fg ansi-bold">    196</span>                 <span class="ansi-green-fg">elif</span> obs<span class="ansi-blue-fg">.</span>return_type <span class="ansi-green-fg">is</span> Variance<span class="ansi-blue-fg">:</span>

<span class="ansi-green-fg">~/anaconda3/envs/QC/lib/python3.7/site-packages/pennylane_qiskit/qiskit_device.py</span> in <span class="ansi-cyan-fg">expval</span><span class="ansi-blue-fg">(self, observable, wires, par)</span>
<span class="ansi-green-intense-fg ansi-bold">    353</span> 
<span class="ansi-green-intense-fg ansi-bold">    354</span>         <span class="ansi-red-fg"># estimate the ev</span>
<span class="ansi-green-fg">--&gt; 355</span><span class="ansi-red-fg">         </span><span class="ansi-green-fg">return</span> np<span class="ansi-blue-fg">.</span>mean<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">.</span>sample<span class="ansi-blue-fg">(</span>observable<span class="ansi-blue-fg">,</span> wires<span class="ansi-blue-fg">,</span> par<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    356</span> 
<span class="ansi-green-intense-fg ansi-bold">    357</span>     <span class="ansi-green-fg">def</span> var<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">,</span> observable<span class="ansi-blue-fg">,</span> wires<span class="ansi-blue-fg">,</span> par<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>

<span class="ansi-green-fg">~/anaconda3/envs/QC/lib/python3.7/site-packages/pennylane_qiskit/qiskit_device.py</span> in <span class="ansi-cyan-fg">sample</span><span class="ansi-blue-fg">(self, observable, wires, par)</span>
<span class="ansi-green-intense-fg ansi-bold">    392</span>             <span class="ansi-red-fg"># Need to convert counts into samples</span>
<span class="ansi-green-intense-fg ansi-bold">    393</span>             samples = np.vstack(
<span class="ansi-green-fg">--&gt; 394</span><span class="ansi-red-fg">                 </span><span class="ansi-blue-fg">[</span>np<span class="ansi-blue-fg">.</span>vstack<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">[</span>s<span class="ansi-blue-fg">]</span> <span class="ansi-blue-fg">*</span> int<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">.</span>shots <span class="ansi-blue-fg">*</span> p<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">)</span> <span class="ansi-green-fg">for</span> s<span class="ansi-blue-fg">,</span> p <span class="ansi-green-fg">in</span> self<span class="ansi-blue-fg">.</span>probabilities<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">.</span>items<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">]</span>
<span class="ansi-green-intense-fg ansi-bold">    395</span>             )
<span class="ansi-green-intense-fg ansi-bold">    396</span> 

<span class="ansi-green-fg">~/anaconda3/envs/QC/lib/python3.7/site-packages/pennylane_qiskit/qiskit_device.py</span> in <span class="ansi-cyan-fg">&lt;listcomp&gt;</span><span class="ansi-blue-fg">(.0)</span>
<span class="ansi-green-intense-fg ansi-bold">    392</span>             <span class="ansi-red-fg"># Need to convert counts into samples</span>
<span class="ansi-green-intense-fg ansi-bold">    393</span>             samples = np.vstack(
<span class="ansi-green-fg">--&gt; 394</span><span class="ansi-red-fg">                 </span><span class="ansi-blue-fg">[</span>np<span class="ansi-blue-fg">.</span>vstack<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">[</span>s<span class="ansi-blue-fg">]</span> <span class="ansi-blue-fg">*</span> int<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">.</span>shots <span class="ansi-blue-fg">*</span> p<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">)</span> <span class="ansi-green-fg">for</span> s<span class="ansi-blue-fg">,</span> p <span class="ansi-green-fg">in</span> self<span class="ansi-blue-fg">.</span>probabilities<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">.</span>items<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">]</span>
<span class="ansi-green-intense-fg ansi-bold">    395</span>             )
<span class="ansi-green-intense-fg ansi-bold">    396</span> 

<span class="ansi-green-fg">&lt;__array_function__ internals&gt;</span> in <span class="ansi-cyan-fg">vstack</span><span class="ansi-blue-fg">(*args, **kwargs)</span>

<span class="ansi-green-fg">~/anaconda3/envs/QC/lib/python3.7/site-packages/numpy/core/shape_base.py</span> in <span class="ansi-cyan-fg">vstack</span><span class="ansi-blue-fg">(tup)</span>
<span class="ansi-green-intense-fg ansi-bold">    278</span>         <span class="ansi-red-fg"># raise warning if necessary</span>
<span class="ansi-green-intense-fg ansi-bold">    279</span>         _arrays_for_stack_dispatcher<span class="ansi-blue-fg">(</span>tup<span class="ansi-blue-fg">,</span> stacklevel<span class="ansi-blue-fg">=</span><span class="ansi-cyan-fg">2</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg">--&gt; 280</span><span class="ansi-red-fg">     </span>arrs <span class="ansi-blue-fg">=</span> atleast_2d<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">*</span>tup<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    281</span>     <span class="ansi-green-fg">if</span> <span class="ansi-green-fg">not</span> isinstance<span class="ansi-blue-fg">(</span>arrs<span class="ansi-blue-fg">,</span> list<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    282</span>         arrs <span class="ansi-blue-fg">=</span> <span class="ansi-blue-fg">[</span>arrs<span class="ansi-blue-fg">]</span>

<span class="ansi-green-fg">&lt;__array_function__ internals&gt;</span> in <span class="ansi-cyan-fg">atleast_2d</span><span class="ansi-blue-fg">(*args, **kwargs)</span>

<span class="ansi-green-fg">~/anaconda3/envs/QC/lib/python3.7/site-packages/numpy/core/shape_base.py</span> in <span class="ansi-cyan-fg">atleast_2d</span><span class="ansi-blue-fg">(*arys)</span>
<span class="ansi-green-intense-fg ansi-bold">    121</span>     res <span class="ansi-blue-fg">=</span> <span class="ansi-blue-fg">[</span><span class="ansi-blue-fg">]</span>
<span class="ansi-green-intense-fg ansi-bold">    122</span>     <span class="ansi-green-fg">for</span> ary <span class="ansi-green-fg">in</span> arys<span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">--&gt; 123</span><span class="ansi-red-fg">         </span>ary <span class="ansi-blue-fg">=</span> asanyarray<span class="ansi-blue-fg">(</span>ary<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    124</span>         <span class="ansi-green-fg">if</span> ary<span class="ansi-blue-fg">.</span>ndim <span class="ansi-blue-fg">==</span> <span class="ansi-cyan-fg">0</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    125</span>             result <span class="ansi-blue-fg">=</span> ary<span class="ansi-blue-fg">.</span>reshape<span class="ansi-blue-fg">(</span><span class="ansi-cyan-fg">1</span><span class="ansi-blue-fg">,</span> <span class="ansi-cyan-fg">1</span><span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">~/anaconda3/envs/QC/lib/python3.7/site-packages/numpy/core/_asarray.py</span> in <span class="ansi-cyan-fg">asanyarray</span><span class="ansi-blue-fg">(a, dtype, order)</span>
<span class="ansi-green-intense-fg ansi-bold">    136</span> 
<span class="ansi-green-intense-fg ansi-bold">    137</span>     &#34;&#34;&#34;
<span class="ansi-green-fg">--&gt; 138</span><span class="ansi-red-fg">     </span><span class="ansi-green-fg">return</span> array<span class="ansi-blue-fg">(</span>a<span class="ansi-blue-fg">,</span> dtype<span class="ansi-blue-fg">,</span> copy<span class="ansi-blue-fg">=</span><span class="ansi-green-fg">False</span><span class="ansi-blue-fg">,</span> order<span class="ansi-blue-fg">=</span>order<span class="ansi-blue-fg">,</span> subok<span class="ansi-blue-fg">=</span><span class="ansi-green-fg">True</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    139</span> 
<span class="ansi-green-intense-fg ansi-bold">    140</span> 

<span class="ansi-red-fg">KeyboardInterrupt</span>: </pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

</div>
 

